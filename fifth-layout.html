<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>å¸ƒå±€ - ç”¨å¤ªå¤šé“¾è¡¨å†™æ³•å­¦ä¹ Rust</title>
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="ç”¨å¤ªå¤šé“¾è¡¨å†™æ³•å­¦ä¹ Rust">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body class="light">
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            document.body.className = theme;
            document.querySelector('html').className = theme + ' js';
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li><a href="index.html"><strong aria-hidden="true">1.</strong> ç®€ä»‹</a></li><li><a href="first.html"><strong aria-hidden="true">2.</strong> ä¸€ä¸ªä¸å¥½çš„æ ˆ</a></li><li><ol class="section"><li><a href="first-layout.html"><strong aria-hidden="true">2.1.</strong> å¸ƒå±€</a></li><li><a href="first-new.html"><strong aria-hidden="true">2.2.</strong> æ–°å»º</a></li><li><a href="first-ownership.html"><strong aria-hidden="true">2.3.</strong> æ‰€æœ‰æƒ101</a></li><li><a href="first-push.html"><strong aria-hidden="true">2.4.</strong> æ¨å…¥</a></li><li><a href="first-pop.html"><strong aria-hidden="true">2.5.</strong> å¼¹å‡º</a></li><li><a href="first-test.html"><strong aria-hidden="true">2.6.</strong> æµ‹è¯•</a></li><li><a href="first-drop.html"><strong aria-hidden="true">2.7.</strong> ä¸¢å¼ƒ</a></li><li><a href="first-final.html"><strong aria-hidden="true">2.8.</strong> æœ€ç»ˆä»£ç </a></li></ol></li><li><a href="second.html"><strong aria-hidden="true">3.</strong> ä¸€ä¸ªå¯ä»¥çš„æ ˆ</a></li><li><ol class="section"><li><a href="second-option.html"><strong aria-hidden="true">3.1.</strong> é€‰é¡¹</a></li><li><a href="second-generic.html"><strong aria-hidden="true">3.2.</strong> æ³›å‹</a></li><li><a href="second-peek.html"><strong aria-hidden="true">3.3.</strong> é€‰æ‹©</a></li><li><a href="second-into-iter.html"><strong aria-hidden="true">3.4.</strong> è¿›å…¥éå†</a></li><li><a href="second-iter.html"><strong aria-hidden="true">3.5.</strong> éå†</a></li><li><a href="second-iter-mut.html"><strong aria-hidden="true">3.6.</strong> å¯å˜éå†</a></li><li><a href="second-final.html"><strong aria-hidden="true">3.7.</strong> æœ€ç»ˆä»£ç </a></li></ol></li><li><a href="third.html"><strong aria-hidden="true">4.</strong> ä¸€ä¸ªæŒä¹…åŒ–çš„æ ˆ</a></li><li><ol class="section"><li><a href="third-layout.html"><strong aria-hidden="true">4.1.</strong> å¸ƒå±€</a></li><li><a href="third-basics.html"><strong aria-hidden="true">4.2.</strong> åŸºæœ¬</a></li><li><a href="third-drop.html"><strong aria-hidden="true">4.3.</strong> ä¸¢å¼ƒ</a></li><li><a href="third-arc.html"><strong aria-hidden="true">4.4.</strong> Arc</a></li><li><a href="third-final.html"><strong aria-hidden="true">4.5.</strong> æœ€ç»ˆä»£ç </a></li></ol></li><li><a href="fourth.html"><strong aria-hidden="true">5.</strong> ä¸€ä¸ªä¸å¥½çš„å®‰å…¨åŒå‘é˜Ÿåˆ—</a></li><li><ol class="section"><li><a href="fourth-layout.html"><strong aria-hidden="true">5.1.</strong> å¸ƒå±€</a></li><li><a href="fourth-building.html"><strong aria-hidden="true">5.2.</strong> æ„å»º</a></li><li><a href="fourth-breaking.html"><strong aria-hidden="true">5.3.</strong> æ‰“ç ´</a></li><li><a href="fourth-peek.html"><strong aria-hidden="true">5.4.</strong> é€‰æ‹©</a></li><li><a href="fourth-symmetry.html"><strong aria-hidden="true">5.5.</strong> å¯¹ç§°æƒ…å†µ</a></li><li><a href="fourth-iteration.html"><strong aria-hidden="true">5.6.</strong> è¿­ä»£</a></li><li><a href="fourth-final.html"><strong aria-hidden="true">5.7.</strong> æœ€ç»ˆä»£ç </a></li></ol></li><li><a href="fifth.html"><strong aria-hidden="true">6.</strong> ä¸€ä¸ªä¸å®‰å…¨çš„é˜Ÿåˆ—</a></li><li><ol class="section"><li><a href="fifth-layout.html" class="active"><strong aria-hidden="true">6.1.</strong> å¸ƒå±€</a></li><li><a href="fifth-unsafe.html"><strong aria-hidden="true">6.2.</strong> ä¸å®‰å…¨</a></li><li><a href="fifth-basics.html"><strong aria-hidden="true">6.3.</strong> åŸºç¡€</a></li><li><a href="fifth-extras.html"><strong aria-hidden="true">6.4.</strong> å…¶ä»–</a></li><li><a href="fifth-final.html"><strong aria-hidden="true">6.5.</strong> æœ€ç»ˆä»£ç </a></li></ol></li><li><a href="sixth.html"><strong aria-hidden="true">7.</strong> ä¸€ä¸ªå¯ä»¥çš„ä¸å®‰å…¨çš„åŒå‘é˜Ÿåˆ—</a></li><li><a href="infinity.html"><strong aria-hidden="true">8.</strong> ä¸€å †å‚»ä¹ä¹çš„é“¾è¡¨</a></li><li><ol class="section"><li><a href="infinity-double-single.html"><strong aria-hidden="true">8.1.</strong> åŒé‡å•é“¾</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar" class="menu-bar">
                    <div id="menu-bar-sticky-container">
                        <div class="left-buttons">
                            <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                                <i class="fa fa-bars"></i>
                            </button>
                            <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                                <i class="fa fa-paint-brush"></i>
                            </button>
                            <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                                <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                                <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            </ul>
                            
                            <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                                <i class="fa fa-search"></i>
                            </button>
                            
                        </div>

                        <h1 class="menu-title">ç”¨å¤ªå¤šé“¾è¡¨å†™æ³•å­¦ä¹ Rust</h1>

                        <div class="right-buttons">
                            <a href="print.html" title="Print this book" aria-label="Print this book">
                                <i id="print-button" class="fa fa-print"></i>
                            </a>
                            
                        </div>
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#å¸ƒå±€" id="å¸ƒå±€">å¸ƒå±€</a></h1>
<p>é‚£ä¹ˆï¼Œå•é“¾é˜Ÿåˆ—æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿå¥½å§ï¼Œå½“æˆ‘ä»¬æœ‰ä¸€ä¸ªå•é“¾æ¥çš„å †æ ˆæ—¶ï¼Œæˆ‘ä»¬æ¨åˆ°åˆ—è¡¨çš„ä¸€ç«¯ï¼Œ
ç„¶åä»åŒä¸€ç«¯å¼¹å‡ºã€‚æ ˆå’Œé˜Ÿåˆ—çš„å”¯ä¸€åŒºåˆ«æ˜¯ï¼Œé˜Ÿåˆ—ä¼šä»<em>å¦</em>ä¸€ç«¯å¼¹å‡ºã€‚æ‰€ä»¥ä»æˆ‘ä»¬çš„å †æ ˆå®ç°
æ¥çœ‹ï¼Œæˆ‘ä»¬æœ‰ï¼š</p>
<pre><code class="language-text">input list:
[Some(ptr)] -&gt; (A, Some(ptr)) -&gt; (B, None)

stack push X:
[Some(ptr)] -&gt; (X, Some(ptr)) -&gt; (A, Some(ptr)) -&gt; (B, None)

stack pop:
[Some(ptr)] -&gt; (A, Some(ptr)) -&gt; (B, None)
</code></pre>
<p>è¦åˆ¶ä½œä¸€ä¸ªé˜Ÿåˆ—ï¼Œæˆ‘ä»¬åªéœ€è¦å†³å®šå°†å“ªä¸ªæ“ä½œç§»åˆ°åˆ—è¡¨çš„æœ«å°¾ï¼šæ¨ï¼Œè¿˜æ˜¯å¼¹ï¼Ÿç”±äºæˆ‘ä»¬çš„åˆ—è¡¨
æ˜¯å•é“¾çš„ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¯ä»¥ç”¨åŒæ ·çš„åŠªåŠ›æŠŠ<em>ä»»ä½•ä¸€ä¸ª</em>æ“ä½œç§»åˆ°æœ€åã€‚</p>
<p>è¦æŠŠ<code>push</code>ç§»åˆ°æœ€åï¼Œæˆ‘ä»¬åªéœ€ä¸€è·¯èµ°åˆ°<code>None</code>ï¼Œå¹¶æŠŠå®ƒå’Œæ–°å…ƒç´ ä¸€èµ·è®¾ç½®ä¸ºSomeã€‚</p>
<pre><code class="language-text">input list:
[Some(ptr)] -&gt; (A, Some(ptr)) -&gt; (B, None)

flipped push X:
[Some(ptr)] -&gt; (A, Some(ptr)) -&gt; (B, Some(ptr)) -&gt; (X, None)
</code></pre>
<p>è¦æŠŠ<code>pop</code>ç§»åˆ°æœ€åï¼Œæˆ‘ä»¬åªéœ€ä¸€è·¯èµ°åˆ°None<em>ä¹‹å‰</em>çš„èŠ‚ç‚¹ï¼Œç„¶å<code>take</code>å®ƒï¼š</p>
<pre><code class="language-text">input list:
[Some(ptr)] -&gt; (A, Some(ptr)) -&gt; (B, Some(ptr)) -&gt; (X, None)

flipped pop:
[Some(ptr)] -&gt; (A, Some(ptr)) -&gt; (B, None)
</code></pre>
<p>æˆ‘ä»¬ä»Šå¤©å¯ä»¥åšè¿™ä¸ªï¼Œç„¶åå°±ä¸å¹²äº†ï¼Œä½†é‚£ä¼šå¾ˆè‡­ï¼ã€‚è¿™ä¸¤ç§æ“ä½œéƒ½æ˜¯åœ¨<em>æ•´ä¸ª</em>åˆ—è¡¨ä¸Šè¡Œèµ°ã€‚æœ‰
äº›äººè®¤ä¸ºï¼Œè¿™æ ·çš„é˜Ÿåˆ—å®ç°ç¡®å®æ˜¯ä¸€ä¸ªé˜Ÿåˆ—ï¼Œå› ä¸ºå®ƒæš´éœ²äº†æ­£ç¡®çš„æ¥å£ã€‚ç„¶è€Œæˆ‘è®¤ä¸ºæ€§èƒ½ä¿è¯æ˜¯
æ¥å£çš„ä¸€éƒ¨åˆ†ã€‚æˆ‘ä¸å…³å¿ƒç²¾ç¡®çš„æ¸è¿‘ç•Œçº¿ï¼Œåªå…³å¿ƒâ€œå¿«â€ä¸â€œæ…¢â€ã€‚é˜Ÿåˆ—ä¿è¯æ¨é€å’Œå¼¹å‡ºæ˜¯å¿«é€Ÿçš„ï¼Œ
è€Œåœ¨æ•´ä¸ªåˆ—è¡¨ä¸Šè¡Œèµ°è‚¯å®šæ˜¯<em>ä¸</em>å¿«çš„ã€‚</p>
<p>ä¸€ä¸ªå…³é”®çš„è§‚å¯Ÿæ˜¯ï¼Œæˆ‘ä»¬åœ¨é‡å¤åš<em>åŒæ ·çš„äº‹æƒ…</em>ï¼Œæµªè´¹äº†å¤§é‡çš„å·¥ä½œã€‚æˆ‘ä»¬èƒ½ä¸èƒ½æŠŠè¿™é¡¹å·¥ä½œè®°
å¿†åŒ–ï¼Ÿä¸ºä»€ä¹ˆï¼Œæ˜¯çš„ï¼Ÿæˆ‘ä»¬å¯ä»¥å­˜å‚¨ä¸€ä¸ªæŒ‡å‘åˆ—è¡¨æœ«å°¾çš„æŒ‡é’ˆï¼Œç„¶åç›´æ¥è·³åˆ°é‚£é‡Œå»ï¼</p>
<p>äº‹å®è¯æ˜ï¼Œåªæœ‰ä¸€ç§åè½¬çš„<code>push</code>å’Œ<code>pop</code>æ–¹å¼å¯ä»¥ä½¿ç”¨ã€‚è¦åè½¬<code>pop</code>ï¼Œæˆ‘ä»¬å¿…é¡»å°†â€œå°¾éƒ¨â€æŒ‡é’ˆ
å‘åç§»åŠ¨ï¼Œä½†ç”±äºæˆ‘ä»¬çš„åˆ—è¡¨æ˜¯å•é“¾çš„ï¼Œæˆ‘ä»¬æ— æ³•æœ‰æ•ˆåœ°åšåˆ°è¿™ä¸€ç‚¹ã€‚å¦‚æœæˆ‘ä»¬åè½¬<code>push</code>ï¼Œæˆ‘
ä»¬åªéœ€è¦å°†â€œå¤´éƒ¨â€æŒ‡é’ˆå‘å‰ç§»åŠ¨ï¼Œè¿™å¾ˆå®¹æ˜“ã€‚</p>
<p>è®©æˆ‘ä»¬è¯•è¯•å§ï¼š</p>
<pre><code class="language-rust ignore">use std::mem;

pub struct List&lt;T&gt; {
    head: Link&lt;T&gt;,
    tail: Link&lt;T&gt;, // NEW!
}

type Link&lt;T&gt; = Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;;

struct Node&lt;T&gt; {
    elem: T,
    next: Link&lt;T&gt;,
}

impl&lt;T&gt; List&lt;T&gt; {
    pub fn new() -&gt; Self {
        List { head: None, tail: None }
    }

    pub fn push(&amp;mut self, elem: T) {
        let new_tail = Box::new(Node {
            elem: elem,
            // When you push onto the tail, your next is always None
            next: None,
        });

        // swap the old tail to point to the new tail
        let old_tail = mem::replace(&amp;mut self.tail, Some(new_tail));

        match old_tail {
            Some(mut old_tail) =&gt; {
                // If the old tail existed, update it to point to the new tail
                old_tail.next = Some(new_tail);
            }
            None =&gt; {
                // Otherwise, update the head to point to it
                self.head = Some(new_tail);
            }
        }
    }
}
</code></pre>
<p>ç”±äºæˆ‘ä»¬å¯¹è¿™ç§äº‹æƒ…åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼Œæ‰€ä»¥æˆ‘ç°åœ¨åœ¨å®ç°ç»†èŠ‚æ–¹é¢èµ°å¾—å¿«ä¸€ç‚¹ã€‚å¹¶ä¸æ˜¯è¯´ä½ åº”è¯¥æœŸæœ›
åœ¨ç¬¬ä¸€æ¬¡å°è¯•æ—¶å°±èƒ½äº§ç”Ÿè¿™æ ·çš„ä»£ç ã€‚æˆ‘åªæ˜¯è·³è¿‡äº†ä¸€äº›æˆ‘ä»¬ä»¥å‰ä¸å¾—ä¸å¤„ç†çš„è¯•éªŒå’Œé”™è¯¯ã€‚å®
é™…ä¸Šï¼Œæˆ‘åœ¨å†™è¿™æ®µä»£ç æ—¶çŠ¯äº†å¾ˆå¤šé”™è¯¯ï¼Œæˆ‘æ²¡æœ‰æ˜¾ç¤ºå‡ºæ¥ã€‚ä½ åªèƒ½çœ‹åˆ°æˆ‘æ¼æ‰äº†<code>mut</code>æˆ–<code>;</code>è¿™ä¹ˆ
å¤šæ¬¡ï¼Œç„¶åå®ƒå°±ä¸å†å…·æœ‰æŒ‡å¯¼æ„ä¹‰äº†ã€‚åˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¾ˆå¤š<em>å…¶ä»–çš„</em>é”™è¯¯ä¿¡æ¯çš„ï¼</p>
<pre><code class="language-text">&gt; cargo build

error[E0382]: use of moved value: `new_tail`
  --&gt; src/fifth.rs:38:38
   |
26 |         let new_tail = Box::new(Node {
   |             -------- move occurs because `new_tail` has type `std::boxed::Box&lt;fifth::Node&lt;T&gt;&gt;`, which does not implement the `Copy` trait
...
33 |         let old_tail = mem::replace(&amp;mut self.tail, Some(new_tail));
   |                                                          -------- value moved here
...
38 |                 old_tail.next = Some(new_tail);
   |                                      ^^^^^^^^ value used here after move
</code></pre>
<p>å‘ç°äº†ï¼</p>
<blockquote>
<p>ä½¿ç”¨äº†ç§»åŠ¨è¿‡çš„å€¼ï¼š <code>new_tail</code></p>
</blockquote>
<p>ç›’å­æ²¡æœ‰å®ç°å¤åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥æŠŠå®ƒåˆ†é…åˆ°ä¸¤ä¸ªä½ç½®ã€‚æ›´é‡è¦çš„æ˜¯ï¼ŒBox<em>æ‹¥æœ‰</em>å®ƒæ‰€æŒ‡å‘
çš„ä¸œè¥¿ï¼Œå½“å®ƒè¢«ä¸¢å¼ƒæ—¶ï¼Œä¼šå°è¯•é‡Šæ”¾å®ƒã€‚å¦‚æœæˆ‘ä»¬çš„<code>push</code>å®ç°è¢«ç¼–è¯‘äº†ï¼Œæˆ‘ä»¬å°±ä¼šæŠŠåˆ—è¡¨çš„
å°¾éƒ¨é‡Šæ”¾å‡ºæ¥ã€‚å®é™…ä¸Šï¼ŒæŒ‰ç…§å†™æ³•ï¼Œæˆ‘ä»¬çš„ä»£ç ä¼šåœ¨æ¯æ¬¡æ¨é€æ—¶é‡Šæ”¾ old_tailã€‚å‘€! ğŸ™€</p>
<p>å¥½äº†ï¼Œæˆ‘ä»¬çŸ¥é“å¦‚ä½•åˆ¶ä½œä¸€ä¸ªä¸èƒ½æ‹¥æœ‰çš„æŒ‡é’ˆã€‚è¿™åªæ˜¯ä¸€ä¸ªå¼•ç”¨ï¼</p>
<pre><code class="language-rust ignore">pub struct List&lt;T&gt; {
    head: Link&lt;T&gt;,
    tail: Option&lt;&amp;mut Node&lt;T&gt;&gt;, // NEW!
}

type Link&lt;T&gt; = Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;;

struct Node&lt;T&gt; {
    elem: T,
    next: Link&lt;T&gt;,
}

impl&lt;T&gt; List&lt;T&gt; {
    pub fn new() -&gt; Self {
        List { head: None, tail: None }
    }

    pub fn push(&amp;mut self, elem: T) {
        let new_tail = Box::new(Node {
            elem: elem,
            // When you push onto the tail, your next is always None
            next: None,
        });

        // Put the box in the right place, and then grab a reference to its Node
        let new_tail = match self.tail.take() {
            Some(old_tail) =&gt; {
                // If the old tail existed, update it to point to the new tail
                old_tail.next = Some(new_tail);
                old_tail.next.as_deref_mut()
            }
            None =&gt; {
                // Otherwise, update the head to point to it
                self.head = Some(new_tail);
                self.head.as_deref_mut()
            }
        };

        self.tail = new_tail;
    }
}
</code></pre>
<p>è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆå¤ªæ£˜æ‰‹çš„é—®é¢˜ã€‚ä¸å‰é¢çš„ä»£ç çš„åŸºæœ¬æ€è·¯ç›¸åŒï¼Œåªæ˜¯æˆ‘ä»¬ä½¿ç”¨äº†ä¸€äº›éšå«è¿”å›çš„
å¥½å¤„ï¼Œä»æˆ‘ä»¬æ”¾ç½®å®é™…Boxçš„åœ°æ–¹æå–å°¾éƒ¨å¼•ç”¨ã€‚</p>
<pre><code class="language-text">&gt; cargo build

error[E0106]: missing lifetime specifier
 --&gt; src/fifth.rs:3:18
  |
3 |     tail: Option&lt;&amp;mut Node&lt;T&gt;&gt;, // NEW!
  |                  ^ expected lifetime parameter
</code></pre>
<p>å“¦ï¼Œå¯¹äº†ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç±»å‹çš„ç”Ÿå‘½æœŸä¸­ç»™å‡ºå‚è€ƒã€‚å—¯......è¿™ä¸ªå¼•ç”¨çš„ç”Ÿå‘½æœŸæ˜¯å¤šå°‘ï¼Ÿå—¯ï¼Œ
è¿™å¥½åƒæ˜¯IterMutï¼Œå¯¹å—ï¼Ÿè®©æˆ‘ä»¬è¯•è¯•æˆ‘ä»¬ä¸ºIterMutæ‰€åšçš„ï¼Œåªæ˜¯æ·»åŠ ä¸€ä¸ªé€šç”¨çš„<code>'a</code>ï¼š</p>
<pre><code class="language-rust ignore">pub struct List&lt;'a, T&gt; {
    head: Link&lt;T&gt;,
    tail: Option&lt;&amp;'a mut Node&lt;T&gt;&gt;, // NEW!
}

type Link&lt;T&gt; = Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;;

struct Node&lt;T&gt; {
    elem: T,
    next: Link&lt;T&gt;,
}

impl&lt;'a, T&gt; List&lt;'a, T&gt; {
    pub fn new() -&gt; Self {
        List { head: None, tail: None }
    }

    pub fn push(&amp;mut self, elem: T) {
        let new_tail = Box::new(Node {
            elem: elem,
            // When you push onto the tail, your next is always None
            next: None,
        });

        // Put the box in the right place, and then grab a reference to its Node
        let new_tail = match self.tail.take() {
            Some(old_tail) =&gt; {
                // If the old tail existed, update it to point to the new tail
                old_tail.next = Some(new_tail);
                old_tail.next.as_deref_mut()
            }
            None =&gt; {
                // Otherwise, update the head to point to it
                self.head = Some(new_tail);
                self.head.as_deref_mut()
            }
        };

        self.tail = new_tail;
    }
}
</code></pre>
<pre><code class="language-text">cargo build

error[E0495]: cannot infer an appropriate lifetime for autoref due to conflicting requirements
  --&gt; src/fifth.rs:35:27
   |
35 |                 self.head.as_deref_mut()
   |                           ^^^^^^^^^^^^
   |
note: first, the lifetime cannot outlive the anonymous lifetime #1 defined on the method body at 18:5...
  --&gt; src/fifth.rs:18:5
   |
18 | /     pub fn push(&amp;mut self, elem: T) {
19 | |         let new_tail = Box::new(Node {
20 | |             elem: elem,
21 | |             // When you push onto the tail, your next is always None
...  |
39 | |         self.tail = new_tail;
40 | |     }
   | |_____^
note: ...so that reference does not outlive borrowed content
  --&gt; src/fifth.rs:35:17
   |
35 |                 self.head.as_deref_mut()
   |                 ^^^^^^^^^
note: but, the lifetime must be valid for the lifetime 'a as defined on the impl at 13:6...
  --&gt; src/fifth.rs:13:6
   |
13 | impl&lt;'a, T&gt; List&lt;'a, T&gt; {
   |      ^^
   = note: ...so that the expression is assignable:
           expected std::option::Option&lt;&amp;'a mut fifth::Node&lt;T&gt;&gt;
              found std::option::Option&lt;&amp;mut fifth::Node&lt;T&gt;&gt;


</code></pre>
<p>å“‡ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ã€‚è¿™æœ‰ç‚¹ä»¤äººæ‹…å¿§ï¼Œå› ä¸ºå®ƒè¡¨æ˜æˆ‘ä»¬æ­£åœ¨åšä¸€äº›éå¸¸æ··ä¹±çš„äº‹
æƒ…ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæœ‰è¶£çš„éƒ¨åˆ†ï¼š</p>
<blockquote>
<p>ç”Ÿå‘½æœŸå¿…é¡»å¯¹å†…è”ä¸­å®šä¹‰çš„ &quot;a &quot;çš„ç”Ÿå‘½æœŸæœ‰æ•ˆã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å€Ÿç”¨äº†<code>self</code>ï¼Œä½†ç¼–è¯‘å™¨å¸Œæœ›æˆ‘ä»¬çš„ç”Ÿå‘½æœŸå’Œ<code>'a</code>ä¸€æ ·é•¿ï¼Œå¦‚æœæˆ‘ä»¬å‘Šè¯‰å®ƒ<code>self</code><em>ç¡®å®</em>
èƒ½æŒç»­é‚£ä¹ˆä¹…å‘¢â€¦â€¦ï¼Ÿ</p>
<pre><code class="language-rust ignore">    pub fn push(&amp;'a mut self, elem: T) {
</code></pre>
<pre><code class="language-text">cargo build

warning: field is never used: `elem`
 --&gt; src/fifth.rs:9:5
  |
9 |     elem: T,
  |     ^^^^^^^
  |
  = note: #[warn(dead_code)] on by default
</code></pre>
<p>å“¦ï¼Œå˜¿ï¼ŒæˆåŠŸäº†! å¾ˆå¥½!</p>
<p>æˆ‘ä»¬ä¹Ÿæ¥åš<code>pop</code>å§ï¼š</p>
<pre><code class="language-rust ignore">pub fn pop(&amp;'a mut self) -&gt; Option&lt;T&gt; {
    // Grab the list's current head
    self.head.take().map(|head| {
        let head = *head;
        self.head = head.next;

        // If we're out of `head`, make sure to set the tail to `None`.
        if self.head.is_none() {
            self.tail = None;
        }

        head.elem
    })
}
</code></pre>
<p>å¹¶ä¸ºæ­¤å†™ä¸€ä¸ªå¿«é€Ÿæµ‹è¯•ï¼š</p>
<pre><code class="language-rust ignore">mod test {
    use super::List;
    #[test]
    fn basics() {
        let mut list = List::new();

        // Check empty list behaves right
        assert_eq!(list.pop(), None);

        // Populate list
        list.push(1);
        list.push(2);
        list.push(3);

        // Check normal removal
        assert_eq!(list.pop(), Some(1));
        assert_eq!(list.pop(), Some(2));

        // Push some more just to make sure nothing's corrupted
        list.push(4);
        list.push(5);

        // Check normal removal
        assert_eq!(list.pop(), Some(3));
        assert_eq!(list.pop(), Some(4));

        // Check exhaustion
        assert_eq!(list.pop(), Some(5));
        assert_eq!(list.pop(), None);
    }
}
</code></pre>
<pre><code class="language-text">cargo test

error[E0499]: cannot borrow `list` as mutable more than once at a time
  --&gt; src/fifth.rs:68:9
   |
65 |         assert_eq!(list.pop(), None);
   |                    ---- first mutable borrow occurs here
...
68 |         list.push(1);
   |         ^^^^
   |         |
   |         second mutable borrow occurs here
   |         first borrow later used here

error[E0499]: cannot borrow `list` as mutable more than once at a time
  --&gt; src/fifth.rs:69:9
   |
65 |         assert_eq!(list.pop(), None);
   |                    ---- first mutable borrow occurs here
...
69 |         list.push(2);
   |         ^^^^
   |         |
   |         second mutable borrow occurs here
   |         first borrow later used here

error[E0499]: cannot borrow `list` as mutable more than once at a time
  --&gt; src/fifth.rs:70:9
   |
65 |         assert_eq!(list.pop(), None);
   |                    ---- first mutable borrow occurs here
...
70 |         list.push(3);
   |         ^^^^
   |         |
   |         second mutable borrow occurs here
   |         first borrow later used here


....

** WAY MORE LINES OF ERRORS **

....

error: aborting due to 11 previous errors
</code></pre>
<p>ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€ğŸ™€</p>
<p>å“¦ï¼Œæˆ‘çš„å¤©å“ªã€‚</p>
<p>ç¼–è¯‘å™¨åœ¨æˆ‘ä»¬èº«ä¸Šå‘•åæ˜¯æ²¡æœ‰é”™çš„ã€‚æˆ‘ä»¬åˆšåˆšçŠ¯äº†ä¸€ä¸ªRustçš„å¤§ç½ªï¼šæˆ‘ä»¬åœ¨<em>è‡ªå·±å†…éƒ¨</em>å­˜å‚¨äº†
ä¸€ä¸ªå¯¹è‡ªå·±çš„å¼•ç”¨ã€‚ä¸çŸ¥ä½•æ•…ï¼Œæˆ‘ä»¬æˆåŠŸåœ°è¯´æœäº†Rustï¼Œåœ¨æˆ‘ä»¬çš„<code>push</code>å’Œ<code>pop</code>å®ç°ä¸­ï¼Œè¿™
å®Œå…¨æ˜¯æœ‰æ„ä¹‰çš„ï¼ˆæˆ‘çœŸçš„å¾ˆéœ‡æƒŠï¼Œæˆ‘ä»¬åšåˆ°äº†ï¼‰ã€‚æˆ‘ç›¸ä¿¡åŸå› æ˜¯Rustè¿˜ä¸èƒ½ä»<code>push</code>å’Œ<code>pop</code>
ä¸­åˆ†è¾¨å‡ºå¼•ç”¨æ˜¯è¿›å…¥è‡ªå·±çš„--æˆ–è€…è¯´ï¼ŒRustæ ¹æœ¬å°±æ²¡æœ‰è¿™ä¸ªæ¦‚å¿µã€‚å¼•ç”¨åˆ°è‡ªå·±èº«ä¸Šä¸èƒ½ç”Ÿæ•ˆåª
æ˜¯ä¸€ç§çªå‘è¡Œä¸ºã€‚</p>
<p>å½“æˆ‘ä»¬è¯•å›¾<em>ä½¿ç”¨</em>æˆ‘ä»¬çš„åˆ—è¡¨æ—¶ï¼Œä¸€åˆ‡éƒ½è¿…é€Ÿå´©æºƒäº†ã€‚å½“æˆ‘ä»¬è°ƒç”¨<code>push</code>æˆ–<code>pop</code>æ—¶ï¼Œæˆ‘ä»¬ç«‹
å³åœ¨è‡ªå·±èº«ä¸Šå­˜å‚¨äº†ä¸€ä¸ªå¯¹è‡ªå·±çš„å¼•ç”¨ï¼Œå¹¶è¢«<em>å›°ä½</em>ã€‚æˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨å€Ÿç”¨æˆ‘ä»¬è‡ªå·±ã€‚</p>
<p>æˆ‘ä»¬çš„<code>pop</code>å®ç°æš—ç¤ºäº†ä¸ºä»€ä¹ˆè¿™å¯èƒ½æ˜¯éå¸¸å±é™©çš„ï¼š</p>
<pre><code class="language-rust ignore">// ...
if self.head.is_none() {
    self.tail = None;
}
</code></pre>
<p>å¦‚æœæˆ‘ä»¬å¿˜è®°è¿™æ ·åšå‘¢ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬çš„å°¾å·´å°±ä¼šæŒ‡å‘<em>æŸä¸ªå·²ç»ä»åˆ—è¡¨ä¸­åˆ é™¤çš„èŠ‚ç‚¹</em>ã€‚è¿™æ ·çš„èŠ‚
ç‚¹ä¼šç«‹å³è¢«é‡Šæ”¾ï¼Œæˆ‘ä»¬å°±ä¼šæœ‰ä¸€ä¸ªæ‚¬ç©ºçš„æŒ‡é’ˆï¼Œè€ŒRuståº”è¯¥ä¿æŠ¤æˆ‘ä»¬å…å—å…¶å®³ï¼</p>
<p>äº‹å®ä¸Šï¼ŒRustæ­£åœ¨ä¿æŠ¤æˆ‘ä»¬è¿œç¦»è¿™ç§å±é™©ã€‚åªæ˜¯ä»¥ä¸€ç§éå¸¸...<strong>è¿‚å›</strong>çš„æ–¹å¼ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬èƒ½åšä»€ä¹ˆå‘¢ï¼Ÿå›åˆ°<code>Rc&lt;RefCell&gt;&gt;</code>åœ°ç‹±ï¼Ÿ</p>
<p>æ‹œæ‰˜äº†ã€‚ä¸ï¼Œä¸ã€‚</p>
<p>ä¸ï¼Œæˆ‘ä»¬è¦ç¦»å¼€è½¨é“ï¼Œä½¿ç”¨<em>åŸå§‹æŒ‡é’ˆ</em>ã€‚æˆ‘ä»¬çš„å¸ƒå±€å°†çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<pre><code class="language-rust ignore">pub struct List&lt;T&gt; {
    head: Link&lt;T&gt;,
    tail: *mut Node&lt;T&gt;, // DANGER DANGER
}

type Link&lt;T&gt; = Option&lt;Box&lt;Node&lt;T&gt;&gt;&gt;;

struct Node&lt;T&gt; {
    elem: T,
    next: Link&lt;T&gt;,
}
</code></pre>
<p>å°±è¿™æ ·äº†ã€‚æ²¡æœ‰è¿™ç§æ‡¦å¼±çš„å‚è€ƒ-è®¡ç®—-åŠ¨æ€-å€Ÿè´·-æ£€æŸ¥çš„åºŸè¯! çœŸå®ã€‚ç¡¬çš„ã€‚æœªç»æ£€æŸ¥çš„ã€‚
æŒ‡é’ˆã€‚</p>
<p>è®©æˆ‘ä»¬éƒ½æˆä¸ºCè¯­è¨€ã€‚è®©æˆ‘ä»¬æ•´å¤©éƒ½æ˜¯Cã€‚</p>
<p>æˆ‘å›æ¥äº†ã€‚æˆ‘å‡†å¤‡å¥½äº†ã€‚</p>
<p>ä½ å¥½ï¼Œ<code>unsafe</code>ã€‚</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="fifth.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="fifth-unsafe.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a href="fifth.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a href="fifth-unsafe.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
